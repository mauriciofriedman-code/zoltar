<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ZOLTAR ‚Ä¢ Or√°culo</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:#0a0611; --bg2:#120a1d; --card:#1a1028;
      --ink:#f2e9ff; --muted:#b6a7d6; --gold:#ffd36e;
      --neon:#8af7ff; --accent:#a26bff;
    }
    body {
      margin:0; font-family:Inter, sans-serif; color:var(--ink);
      background:linear-gradient(180deg, var(--bg), var(--bg2));
      display:flex; flex-direction:column; min-height:100vh;
    }
    header {
      padding:16px; text-align:center; background:#0a0611; border-bottom:1px solid rgba(255,211,110,.2);
    }
    header h1 {
      margin:0; font-family:"Playfair Display",serif; font-weight:900; color:var(--gold);
    }
    .tagline { margin:4px 0 0; color:var(--muted); font-size:14px; }
    main { 
      flex:1; 
      display:flex; 
      justify-content:center; 
      align-items:flex-start; 
      padding:20px; 
      flex-direction:column; /* default PC/vertical */
    }
    .card {
      background:var(--card); border:1px solid rgba(162,107,255,.35);
      border-radius:18px; padding:20px; max-width:500px; width:100%;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      text-align:center; position:relative;
      margin-bottom:20px;
    }
    .machine img {
      width:100%; border:5px solid var(--gold); border-radius:12px;
      transition: box-shadow .3s;
    }
    .machine.thinking img {
      animation: glowBorder 1.5s infinite alternate;
    }
    @keyframes glowBorder {
      from { box-shadow:0 0 10px var(--gold), inset 0 0 5px var(--gold); }
      to   { box-shadow:0 0 25px var(--gold), inset 0 0 15px var(--gold); }
    }

    .toolbar { margin:12px 0; display:flex; justify-content:center; gap:20px; color:var(--muted); }

    .panel { 
      margin-top:16px;
      display:flex;
      flex-direction:column;
      align-items:center; 
    }
    input, button {
      padding:10px; border-radius:8px; border:none; margin:5px;
    }
    input { width:65%; background:#0c0813; color:var(--ink); border:1px solid #38204f; }
    button { cursor:pointer; background:var(--gold); font-weight:bold; color:#000; }
    #askBtn { margin-top:10px; align-self:center; }
    .output {
      margin-top:15px; min-height:80px; background:#0a0611; color:white;
      padding:10px; border-radius:8px; text-align:left;
      width:100%;
    }

    .coin-slot {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      margin: 10px 0;
      position: relative;
    }

    .coin {
      width: 60px;
      height: 60px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .coin:hover {
      transform: scale(1.1) rotate(-5deg);
    }

    .slot {
      width: 25px;
      height: 60px;
      background: linear-gradient(180deg, #333, #111);
      border: 2px solid #555;
      border-radius: 4px;
      position: relative;
      box-shadow: inset 0 0 6px #000;
    }
    .slot::after {
      content: "";
      position: absolute;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      width: 10px;
      height: 30px;
      background: #000;
      border-radius: 2px;
    }

    /* Moneda animada hacia el slot */
    .moving-coin {
      position: fixed;
      width: 60px;
      height: 60px;
      pointer-events: none;
      transition: transform 0.8s ease-in-out, opacity 0.8s ease-in-out;
      z-index: 9999;
    }

    footer {
      text-align:center;
      font-size:12px;
      color:var(--muted);
      padding:10px;
      border-top:1px solid rgba(255,211,110,.2);
      background:#0a0611;
    }
    footer span { color:var(--gold); }

    /* üì± Smartphone horizontal */
    @media screen and (max-width: 900px) and (orientation: landscape) {
      main {
        flex-direction: row; 
        justify-content: space-around;
        align-items: flex-start;
      }
      .card {
        width: 45%; 
        margin: 0 10px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>ZOLTAR</h1>
    <p class="tagline">Fortuna pedag√≥gica en cada respuesta</p>
  </header>

  <main>
    <section class="card">
      <div class="machine" id="machine">
        <img id="zoltarImg" src="/img/Zoltar_1.png" alt="Zoltar" />
      </div>

      <div class="toolbar">
        <label><input type="radio" name="mode" value="simple" checked> Modelo simple</label>
        <label><input type="radio" name="mode" value="rag"> Modelo RAG</label>
      </div>

      <div class="panel">
        <input id="question" type="text" placeholder="Haz tu consulta..." disabled />

        <!-- Slot arcade con moneda -->
        <div class="coin-slot">
          <img id="coinBtn" src="/img/coin.png" alt="Moneda Zoltar" class="coin" />
          <div class="slot" id="slot"></div>
        </div>

        <button id="askBtn" disabled>Consultar</button>
        <div class="output" id="output">Aqu√≠ aparecer√° la respuesta...</div>
      </div>
    </section>
  </main>

  <footer>
    Animaci√≥n de Zoltar creada por <span>Naomi Friedman</span>
  </footer>

  <!-- üéµ Sonidos -->
  <audio id="soundCoin" src="/sounds/coin.mp3" preload="auto"></audio>
  <audio id="soundThinking" src="/sounds/thinking.mp3" preload="auto" loop></audio>
  <audio id="soundReveal" src="/sounds/reveal.mp3" preload="auto"></audio>

  <script>
    const BACKEND_URL = window.location.hostname.includes("localhost")
      ? "http://127.0.0.1:8000"
      : "";

    const zoltarImg = document.getElementById("zoltarImg");
    const machineDiv = document.getElementById("machine");
    const coinBtn = document.getElementById("coinBtn");
    const askBtn = document.getElementById("askBtn");
    const question = document.getElementById("question");
    const output = document.getElementById("output");
    const modeRadios = document.querySelectorAll("input[name='mode']");
    const slot = document.getElementById("slot");

    const coinSound = document.getElementById("soundCoin");
    const thinkingSound = document.getElementById("soundThinking");
    const revealSound = document.getElementById("soundReveal");

    const frames = [
      "/img/Zoltar_1.png","/img/Zoltar_2.png","/img/Zoltar_3.png",
      "/img/Zoltar_4.png","/img/Zoltar_5.png","/img/Zoltar_4.png",
      "/img/Zoltar_3.png","/img/Zoltar_2.png"
    ];
    let frameIndex = 0, animInterval=null;

    function showFrame(i) {
      frameIndex = (i+frames.length)%frames.length;
      zoltarImg.src = frames[frameIndex];
    }
    function startAnim() {
      frameIndex=0; clearInterval(animInterval);
      animInterval=setInterval(()=>showFrame(frameIndex+1),150);
      machineDiv.classList.add("thinking");
      thinkingSound.currentTime=0;
      thinkingSound.play().catch(()=>{});
    }
    function stopAnim() {
      clearInterval(animInterval); animInterval=null;
      zoltarImg.src=frames[0];
      machineDiv.classList.remove("thinking");
      thinkingSound.pause();
    }

    let hasCoin=false;
    coinBtn.addEventListener("click",()=>{
      const coinClone=document.createElement("img");
      coinClone.src="/img/coin.png";
      coinClone.className="moving-coin";

      const rectCoin=coinBtn.getBoundingClientRect();
      const rectSlot=slot.getBoundingClientRect();

      coinClone.style.left=rectCoin.left+"px";
      coinClone.style.top=rectCoin.top+"px";

      document.body.appendChild(coinClone);
      void coinClone.offsetWidth;

      const dx = rectSlot.left - rectCoin.left;
      const dy = rectSlot.top - rectCoin.top;

      coinClone.style.transform=`translate(${dx}px, ${dy}px) scale(0.6) rotate(360deg)`;
      coinClone.style.opacity="0";

      setTimeout(()=>coinClone.remove(),800);

      hasCoin=true; 
      question.disabled=false; 
      askBtn.disabled=false;
      output.textContent="Inserta tu pregunta...";
      question.focus();
      coinSound.currentTime=0; coinSound.play().catch(()=>{});
    });

    askBtn.addEventListener("click",async()=>{
      if(!hasCoin) return;
      const q = question.value.trim();
      if(!q){ return; }

      hasCoin=false; startAnim();
      output.textContent="Zoltar est√° pensando...";
      const mode=[...modeRadios].find(r=>r.checked).value;
      const endpoint = mode==="rag" ? "/api/teacher" : "/api/generate";

      try{
        const body = mode==="rag"
          ? { text: q }
          : { text: q, mode: "engineered" };

        const res=await fetch(BACKEND_URL+endpoint,{
          method:"POST", headers:{"Content-Type":"application/json"},
          body: JSON.stringify(body)
        });

        if(!res.ok){
          let msg = `Error del backend (${res.status})`;
          try {
            const err = await res.json();
            if(err.detail) msg += `: ${err.detail}`;
          } catch {}
          output.textContent = msg;
          console.error("Respuesta del servidor:", res);
        } else {
          const data=await res.json();
          output.textContent=data.answer||data.text||"Respuesta vac√≠a.";
        }
      } catch(e){
        await new Promise(r=>setTimeout(r,800));
        output.textContent="No fue posible conectar con el servicio.";
        console.error(e);
      } finally {
        stopAnim();
        revealSound.currentTime=0; revealSound.play().catch(()=>{});
        question.value=""; question.disabled=true; askBtn.disabled=true;
      }
    });
  </script>
</body>
</html>



